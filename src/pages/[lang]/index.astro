---
import {i18nUtils} from '../../i18n/i18nUtils';
import {getRelativeLocaleUrl} from 'astro:i18n';
import HighlightCard from "../../components/HighlightCard.astro";
import FeatureCard from "../../components/FeatureCard.astro";
import LanguageSwitch from '../../components/LanguageSwitch.astro';
import Head from '../../components/Head.astro';
import '../../styles/style.css';
import IndexLayout from '../../layouts/IndexLayout.astro';
import Navbar from '../../components/Navbar.astro';

export const ssr = true;
// ensure the exported 'ssr' is referenced so TypeScript doesn't warn it's unused
void ssr;

const {lang} = Astro.params;
const locales = ['de', 'en'];
const isValidLang = typeof lang === 'string' && locales.includes(lang);

let translations;
let siteTitle;
let siteDescription;
let explorerUrl;

if (isValidLang) {
    translations = i18nUtils.getTranslations(lang);
    siteTitle = translations.common.siteTitle;
    siteDescription = translations.common.siteDescription;
    explorerUrl = getRelativeLocaleUrl(lang, 'explorer');
} else {
    // Invalid locale in the path (e.g. /brokenlink). Return a 404 with default locale translations.
    Astro.response.status = 404;
    const defaultLang = 'de';
    translations = i18nUtils.getTranslations(defaultLang);
    siteTitle = translations.page404.title;
    siteDescription = translations.common.siteDescription;
    explorerUrl = `/${defaultLang}/explorer`;
}

// Remove unused deUrl/enUrl and create a typedLang for safe prop typing
const typedLang = (isValidLang ? (lang as 'de' | 'en') : 'de');
---
<IndexLayout title={siteTitle} lang={isValidLang ? lang : 'de'}>
    <Head slot="Head" title={siteTitle} description={siteDescription}/>


    <div slot="Hero">
        <Navbar>
            <a slot="Logo" href="/" >
                <figure class="logo">
                    <img src="/assets/favicon.svg" alt="MOXR Logo" width="100" height="100"/>
                </figure>
            </a>
            <LanguageSwitch lang={typedLang} slot="LanguageSwitch"/>
            <a href={explorerUrl} slot="ExplorerPage">{translations.indexPage.explorerTitle}</a>
            <a href="/" slot="ContactPage">Contact</a>
        </Navbar>
    </div>

    <div slot="HighlightCard">
        <h2>{translations.indexPage.highlightCard.title}</h2>
        <p>{translations.indexPage.highlightCard.description}</p>
        <HighlightCard
                highlightCardTitle1={translations.indexPage.highlightCard.highlightCard1.title}
                highlightCardSubTitle1={translations.indexPage.highlightCard.highlightCard1.description}
                highlightCardTitle2={translations.indexPage.highlightCard.highlightCard2.title}
                highlightCardSubTitle2={translations.indexPage.highlightCard.highlightCard2.description}
                highlightCardTitle3={translations.indexPage.highlightCard.highlightCard3.title}
                highlightCardSubTitle3={translations.indexPage.highlightCard.highlightCard3.description}
        />
    </div>

    <div slot="Features">
        <h2>{translations.indexPage.featuresTitle}</h2>
        <div class="features-grid">
            <FeatureCard
                    title1={translations.indexPage.features.feature1.title}
                    subtitle1={translations.indexPage.features.feature1.description}
                    imgSrc1={'https://placehold.co/200x200'}
                    gifSrc1={'https://c.tenor.com/GdtADgzLdLUAAAAC/tenor.gif'}

                    title2={translations.indexPage.features.feature2.title}
                    subtitle2={translations.indexPage.features.feature2.description}
                    imgSrc2={'https://placehold.co/200x200'}
                    gifSrc2={'https://c.tenor.com/GdtADgzLdLUAAAAC/tenor.gif'}

                    title3={translations.indexPage.features.feature3.title}
                    subtitle3={translations.indexPage.features.feature3.description}
                    imgSrc3={'https://placehold.co/200x200'}
                    gifSrc3={'https://c.tenor.com/GdtADgzLdLUAAAAC/tenor.gif'}

                    title4={translations.indexPage.features.feature4.title}
                    subtitle4={translations.indexPage.features.feature4.description}
                    imgSrc4={'https://placehold.co/200x200'}
                    gifSrc4={'https://c.tenor.com/GdtADgzLdLUAAAAC/tenor.gif'}
            />
        </div>
    </div>

    <div slot="CTA">
    </div>

    <div slot="Footer">
    </div>
</IndexLayout>